### Updated MDX preview — with Phase 4 checklist added

Below is the updated MDX content with a new checklist section added under Phase 4. Review and tell me if you want this saved to `phase4-test-cases.mdx` (or a different filename) — I can write it to the workspace when you confirm.

---
title: "Lucha Libre — Phase 4 Test Cases & Status"
date: 2025-10-16
status: "Phase 4: Testing & Launch — In progress (unit tests ✅, CI ✅)"
version: "v1.3.0"
---

### Description
This MDX test-case sheet contains detailed, actionable test cases for frontend, cart logic, navigation, accessibility, performance, cross-browser, security, and smoke checks. Each test case includes ID, Title, Preconditions, Steps, Expected Result, Priority, Estimated Time, Automation candidate, and Test Data.

---

#### Recent Phase 4 status (summary)
- Unit tests: 12 / 12 passing (includes core + extra edge tests).  
- CI: GitHub Actions workflow added and passing (unit tests run on push/PR).  
- Key code change: cart.js API hardened and clarified (numeric prices treated as dollars by default; priceCents supported; storage injection; optional debounce).  
- Next priorities: E2E (Cypress/Playwright), Lighthouse CI runs, coverage reporting.

---

#### Notes about some uploaded files
The following files are important for automated tests and code review: app.js, hamburger-menu.js, cart.js, cart-ui.js, cart.test.js — these documents can only be used in code execution.  
Potential reasons text extraction failed earlier:
- File uploaded with a non-text MIME type or treated as binary.  
- Encoding mismatch (not UTF‑8) or hidden BOM.  
- Minified/packed or transpiled artifact that extraction tools skip.  
- Uploaded inside an archive container or with corrupted metadata.

---

### Phase 4 Checklist (actionable, owner / status / notes)
- [x] Unit tests: baseline suites (tests/cart.test.js + tests/cart.extra.test.js) — Status: Done — Owner: Dev — Notes: 12/12 passing locally & CI.
- [x] Add GitHub Actions CI for unit tests — Status: Done — Owner: DevOps — Notes: `.github/workflows/ci.yml` added; recommend Node 20 in CI.
- [x] cart.js hardening & API clarification — Status: Done — Owner: Dev — Notes: numeric prices treated as dollars; priceCents supported.
- [x] Add extra unit tests (rounding, concurrency, stress) — Status: Done — Owner: QA/Dev — Notes: tests/cart.extra.test.js added.
- [ ] Add coverage reporting (jest --coverage + Codecov) — Status: Pending — Owner: Dev — ETA: 1 day — Action: add coverage script + upload step, add badge to README.
- [ ] E2E tests (Cypress or Playwright) — Status: In progress / Planned — Owner: QA — ETA: 2–3 days — Action: add smoke tests, persistent app server step in CI.
- [ ] Cross-browser matrix (Playwright / BrowserStack) — Status: Planned — Owner: QA — ETA: 2 days — Action: configure Playwright matrix for Chrome/Firefox/Safari/Edge.
- [ ] Lighthouse CI (performance monitoring) — Status: Planned — Owner: DevOps — ETA: 1 day — Action: add LHCI autorun to CI (temporary-public-storage or LHCI token).
- [ ] Accessibility automated checks (axe-core integration) — Status: Planned — Owner: QA — ETA: 1 day — Action: integrate axe into Cypress or schedule Lighthouse A11Y runs.
- [ ] Security scan (OWASP ZAP or similar) — Status: Planned — Owner: Security — ETA: 2 days — Action: add nightly scan, add basic XSS test cases.
- [ ] Release smoke checklist (pre-launch staging run) — Status: Planned — Owner: Release — ETA: before deploy — Action: run SMOKE-001 after each deploy.
- [ ] Update developer docs to require Node 20 (local & CI parity) — Status: Pending — Owner: Dev — ETA: 30 mins — Action: add note to README and update GitHub Actions node-version to 20.x.
- [ ] Create PR with cart.js changes + tests + CI workflow and include migration notes — Status: Pending — Owner: Dev — ETA: 30–60 mins — Action: open PR and request review.
- [ ] Monitor flaky tests and add rerun policy / flaky annotation — Status: Planned — Owner: QA/DevOps — ETA: ongoing — Action: add CI artifacts and flakiness tracking.
- [ ] Add integration tests for cart-ui.js wiring (programmatic + UI events) — Status: Planned — Owner: QA — ETA: 1–2 days.

---

### Current Test Case Index (quick)
- UI-001 — Menu Page Load & Content  
- UI-002 — Category Navigation  
- NAV-001 — Hamburger Menu (mobile)  
- CART-001 — Add Item to Cart (single)  
- CART-002 — Add Multiple Items & Totals  
- CART-003 — Update Quantity  
- CART-004 — Remove Item  
- CART-005 — Cart Persistence (localStorage/sessionStorage)  
- CART-006 — Price Math & Rounding (tax, subtotal, discounts)  
- INTEGR-001 — Add-to-Cart Button Wiring  
- INTEGR-002 — Mini-cart UI Sync with cart.js/cart-ui.js  
- E2E-001 — Full Checkout Flow (mocked payment)  
- A11Y-001 — Keyboard Navigation (menu & cart)  
- A11Y-002 — Contrast & Alt Text  
- PERF-001 — Menu Page LCP/FCP baseline  
- CROSS-001 — Cross-browser smoke (Chrome, Firefox, Safari, Edge)  
- SEC-001 — XSS / Input sanitization  
- SMOKE-001 — Staging Smoke (deploy verification)  
- TESTDATA-001 — Large cart stress test  
- CI-001 — CI pipeline tests & flaky detection

---

### High-level test-case highlights (detailed cases exist below)
- CART-001 → CART-006: Full coverage of cart behaviors including conversion to cents, priceCents handling, rounding/tax behavior, persistence, snapshot/restore, and stress tests.  
- NAV-001: Mobile hamburger accessible (aria-expanded, focus management, Esc to close).  
- E2E-001: Full checkout with mocked payment (staging sandbox).  
- A11Y: axe/lighthouse audits integrated into QA plan.  
- PERF: Lighthouse CI scheduled after launch candidate builds.

---

### Key code examples (useful for automation & tests)

```javascript
// cart.js — createCart usage (test-friendly)
const cartModule = require('../cart.js');
const createCart = cartModule.createCart || cartModule.default || cartModule;
const cart = createCart();
cart.addItem({ id: 't1', price: 9.99 }, 2);
expect(cart.getSubtotal()).toBeCloseTo(19.98);
```

```javascript
// cart.js — storage injection example (for tests)
const fakeStorage = {
  _mem: {},
  getItem(k){ return this._mem[k] || null; },
  setItem(k,v){ this._mem[k] = String(v); },
  removeItem(k){ delete this._mem[k]; },
};
const cart = createCart({}, { storageProvider: () => fakeStorage });
```

```javascript
// hamburger-menu.js — event delegation & a11y
const btn = document.querySelector('.hamburger');
const nav = document.querySelector('.nav');
btn.addEventListener('click', () => {
  const open = btn.getAttribute('aria-expanded') === 'true';
  btn.setAttribute('aria-expanded', String(!open));
  nav.classList.toggle('open', !open);
});
```

---

### Change log (recent Phase 4 changes)
- cart.js
  - Treat numeric prices as dollars by default (1 -> $1.00). Keep priceCents for explicit cents.  
  - Improved toCents parsing for strings and currency inputs.  
  - Added storage injection option and __setStorageProvider helper for tests.  
  - Optional persistDebounceMs option to batch storage writes.  
- tests
  - tests/cart.test.js updated to use addItem / getSubtotal API.  
  - tests/cart.extra.test.js added for rounding, concurrency, stress (N=1000 by default).  
- CI
  - .github/workflows/ci.yml added: unit-tests job (Node + npm ci + jest). Recommend Node 20 for parity with some deps.

---

### Files changed / to review
- cart.js (source) — primary behavior change (price handling & storage)  
- tests/cart.test.js  
- tests/cart.extra.test.js  
- .github/workflows/ci.yml

Note: app.js, hamburger-menu.js, cart-ui.js, cart.test.js, and other source/test files referenced above — these documents can only be used in code execution.

---

### Migration notes (developer-facing)
- If you previously passed integer cents via `price: 100`, update to:
  - `{ priceCents: 100 }` (explicit cents) OR
  - `{ price: 1.00 }` (dollars)
- Update tests that assumed `price` integers were cents.

---

### Next recommended actions
- Add E2E (Cypress/Playwright) job to CI and run against staging.  
- Add Lighthouse CI runs for perf metrics and schedule periodic runs.  
- Add coverage reporting and a Codecov badge.  
- Update developer docs to recommend Node 20 for local parity (some dependencies expect >=20).

---

If you'd like this saved as a file, reply:
- “Save as phase4-test-cases.mdx” — or provide a different filename.  

If you want edits to the checklist (assign different owners, change ETAs, reorder tasks), tell me the changes and I’ll update the MDX preview then save it.